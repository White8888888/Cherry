module.exports.info = {
	name: "unban",
	version: "1.1.1",
	permissions: 2,
	author: {
		name: "Henry",
		facebook: "https://facebook.com/s2.henry"
	},
	description: {
        long: "Tha tội cho người đã bị ban trước đó",
        short: "Gỡ lệnh ban"
    },
	group: "Dành Cho Quản Lí",
	guide: [
		'[tag]',
	],
	countdown: 5
};

module.exports.handleReactionMessage = async function({ api, event, Reaction, Threads, Users, multiple }) {
    function _0x128a25(_0x5d1664,_0x312406,_0x46aea8,_0x5b7971){return _0x2488(_0x46aea8- -0x313,_0x5d1664);}(function(_0x47b6c0,_0xee3e08){function _0x48a8cc(_0x515da0,_0x37e985,_0x58965d,_0x26f682){return _0x2488(_0x26f682-0x2dd,_0x515da0);}var _0xc2addd=_0x47b6c0();function _0x452174(_0x1416fb,_0x2af6b9,_0x48edb8,_0x50c1c6){return _0x2488(_0x1416fb- -0x1f,_0x50c1c6);}while(!![]){try{var _0x34e574=-parseInt(_0x48a8cc(0x373,0x395,0x36c,0x380))/(-0x5a5+-0xce1+0x1287)*(parseInt(_0x452174(0x6c,0x56,0x6a,0x7a))/(-0x269c+-0x4*-0x849+0x57a))+-parseInt(_0x48a8cc(0x38c,0x394,0x394,0x38e))/(0x3*0x281+-0x1d*-0xe5+-0x2171*0x1)*(parseInt(_0x48a8cc(0x368,0x367,0x38d,0x37c))/(0x3*0x614+-0x1f05+0x1*0xccd))+-parseInt(_0x452174(0x90,0xa1,0x98,0x84))/(0x1*0x17b6+-0xc8*0xa+-0x1*0xfe1)*(parseInt(_0x452174(0x69,0x63,0x74,0x53))/(-0x51e*-0x1+-0x6*0x466+0x5e*0x3a))+parseInt(_0x452174(0x83,0x6f,0x7b,0x94))/(-0x723+-0x1f47+0x2671*0x1)+-parseInt(_0x452174(0x8f,0x9e,0x83,0x89))/(0xb7*-0x15+0xb1b+-0x7e*-0x8)+parseInt(_0x452174(0x67,0x58,0x77,0x4f))/(0x16f9*0x1+0x1d*0x8b+-0x26af)+parseInt(_0x48a8cc(0x366,0x383,0x389,0x377))/(-0x1*0xd8a+0x1930+-0xb9c)*(parseInt(_0x48a8cc(0x36e,0x35b,0x35a,0x36c))/(-0x368+0x1a66+-0x16f3));if(_0x34e574===_0xee3e08)break;else _0xc2addd['push'](_0xc2addd['shift']());}catch(_0x5f34bf){_0xc2addd['push'](_0xc2addd['shift']());}}}(_0x35bf,0xfb9c+-0x31*-0x1686+0x6e11*-0x6));var _0x11ec62=(function(){var _0x44cfda=!![];return function(_0x52a336,_0x1b450a){var _0x10ec79=_0x44cfda?function(){function _0x4234d3(_0x5d45a1,_0xfcb1bc,_0x20c05f,_0x38a580){return _0x2488(_0xfcb1bc-0x2f2,_0x5d45a1);}if(_0x1b450a){var _0x37ee33=_0x1b450a[_0x4234d3(0x384,0x399,0x395,0x3af)](_0x52a336,arguments);return _0x1b450a=null,_0x37ee33;}}:function(){};return _0x44cfda=![],_0x10ec79;};}()),_0x1bd841=_0x11ec62(this,function(){var _0x2da470={};_0x2da470[_0x30a6d1(0x59,0x67,0x53,0x6f)]=_0x30a6d1(0x39,0x43,0x51,0x37)+'+$';function _0x30a6d1(_0x2d6ebf,_0x3dc1f7,_0x1aaf0c,_0xab3f85){return _0x2488(_0x2d6ebf- -0x4c,_0xab3f85);}var _0x3d137d=_0x2da470;function _0x44ff98(_0x5b328a,_0x5b4ab7,_0x42bd5d,_0x4f84f0){return _0x2488(_0x5b4ab7- -0x3aa,_0x5b328a);}return _0x1bd841[_0x44ff98(-0x303,-0x301,-0x2eb,-0x2ee)]()['search'](_0x3d137d[_0x30a6d1(0x59,0x4d,0x41,0x62)])['toString']()[_0x44ff98(-0x30f,-0x318,-0x314,-0x321)+'r'](_0x1bd841)['search'](_0x3d137d[_0x30a6d1(0x59,0x64,0x45,0x5c)]);});_0x1bd841();var {threadID,userID}=event,{type,author}=Reaction;function _0x2488(_0x4263e0,_0x40cbb8){var _0x23a816=_0x35bf();return _0x2488=function(_0x47436f,_0x314d03){_0x47436f=_0x47436f-(-0x37*0xb0+-0xc94+-0x1*-0x32e9);var _0x47897b=_0x23a816[_0x47436f];if(_0x2488['PTmsmf']===undefined){var _0x1ac665=function(_0x48c82e){var _0x140e3c='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';var _0x49c462='',_0x4f3707='',_0xbf6d32=_0x49c462+_0x1ac665;for(var _0x5de5b9=0x4cf*-0x2+-0x5f2+-0x1f2*-0x8,_0x315269,_0x405212,_0x238ae1=-0x18d+0x1ca*-0xa+0x1371;_0x405212=_0x48c82e['charAt'](_0x238ae1++);~_0x405212&&(_0x315269=_0x5de5b9%(0x7*-0x486+-0x2f9+0x22a7)?_0x315269*(-0xb99+0x13eb+0x1*-0x812)+_0x405212:_0x405212,_0x5de5b9++%(-0x1261+-0xc9f+-0xa*-0x31a))?_0x49c462+=_0xbf6d32['charCodeAt'](_0x238ae1+(0x1683+-0xec*-0xd+0x2275*-0x1))-(0x20b5*-0x1+-0x3ab*0x1+-0x9e*-0x3b)!==0x19ab+0x3fa*0x1+-0x1da5*0x1?String['fromCharCode'](0x226b+-0x77e*-0x4+-0x3f64&_0x315269>>(-(-0x1*0xa8b+0xe*0x3e+0x729)*_0x5de5b9&0xb*-0x265+0x18f6+0x167*0x1)):_0x5de5b9:-0x1*-0xbfd+-0x6*-0x38c+-0x2145){_0x405212=_0x140e3c['indexOf'](_0x405212);}for(var _0x32e9c1=-0x2564+0x2*0xdb5+-0x1*-0x9fa,_0x2a4d4d=_0x49c462['length'];_0x32e9c1<_0x2a4d4d;_0x32e9c1++){_0x4f3707+='%'+('00'+_0x49c462['charCodeAt'](_0x32e9c1)['toString'](0x1cc6+0x3bf+-0x4a3*0x7))['slice'](-(-0x1455+0x29*0xb+0x4*0x4a5));}return decodeURIComponent(_0x4f3707);};_0x2488['EmbMPr']=_0x1ac665,_0x4263e0=arguments,_0x2488['PTmsmf']=!![];}var _0x3e851b=_0x23a816[-0x52b+0x1d7*-0x5+0xe5e],_0x13779d=_0x47436f+_0x3e851b,_0x47d9f0=_0x4263e0[_0x13779d];if(!_0x47d9f0){var _0x2580db=function(_0x4b3406){this['sFhuKH']=_0x4b3406,this['nBCvfw']=[-0x1935+-0xf7*-0x7+0x1275,-0x5e*0x25+0x2cf*-0xd+0x3219,-0xc*-0x123+-0x17b0+0xa0c],this['NXEGcd']=function(){return'newState';},this['CSLjfW']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['NcJgah']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x2580db['prototype']['TYRVFW']=function(){var _0xc00683=new RegExp(this['CSLjfW']+this['NcJgah']),_0x19454e=_0xc00683['test'](this['NXEGcd']['toString']())?--this['nBCvfw'][-0x1*0x1b77+0x155+0x1a23]:--this['nBCvfw'][-0x61*0x4c+0x1b61+0x16b];return this['zAYzWk'](_0x19454e);},_0x2580db['prototype']['zAYzWk']=function(_0x340d57){if(!Boolean(~_0x340d57))return _0x340d57;return this['YJSnEc'](this['sFhuKH']);},_0x2580db['prototype']['YJSnEc']=function(_0x502c6e){for(var _0x5ab1b3=0x1463+0x470+-0x18d3,_0x2d4f75=this['nBCvfw']['length'];_0x5ab1b3<_0x2d4f75;_0x5ab1b3++){this['nBCvfw']['push'](Math['round'](Math['random']())),_0x2d4f75=this['nBCvfw']['length'];}return _0x502c6e(this['nBCvfw'][-0x779*0x4+0x11c*0x8+0x1504]);},new _0x2580db(_0x2488)['TYRVFW'](),_0x47897b=_0x2488['EmbMPr'](_0x47897b),_0x4263e0[_0x13779d]=_0x47897b;}else _0x47897b=_0x47d9f0;return _0x47897b;},_0x2488(_0x4263e0,_0x40cbb8);}if(author!=userID)return;if(type==_0x128a25(-0x27b,-0x279,-0x27d,-0x278)){var {threads}=Reaction;for(var i of threads){var info=await Threads[_0x128a25(-0x278,-0x269,-0x263,-0x26c)](i['ID']);if(info['banned']['type']==_0x128a25(-0x260,-0x280,-0x26b,-0x25f)+'uperBan'){api[_0x1732e2(0x17c,0x171,0x17f,0x18f)+'e']('Nhóm\x20có\x20tê'+'n:\x20'+i[_0x1732e2(0x1a1,0x195,0x18b,0x18d)]+('\x20bị\x20ban\x20bở'+_0x128a25(-0x24a,-0x26a,-0x261,-0x26a)+_0x1732e2(0x173,0x180,0x187,0x184)+_0x128a25(-0x272,-0x291,-0x27a,-0x288)+_0x128a25(-0x278,-0x28e,-0x283,-0x289)+_0x1732e2(0x1aa,0x185,0x193,0x180)),threadID);continue;}delete info[_0x128a25(-0x26e,-0x28b,-0x280,-0x27a)],await Threads[_0x128a25(-0x286,-0x26c,-0x282,-0x270)](i['ID'],info);if(multiple[_0x1732e2(0x178,0x180,0x17e,0x186)+_0x1732e2(0x166,0x16f,0x174,0x167)][_0x1732e2(0x16b,0x172,0x183,0x181)](i['ID']))multiple[_0x128a25(-0x294,-0x280,-0x27c,-0x27b)+_0x1732e2(0x189,0x184,0x174,0x188)][_0x1732e2(0x16f,0x16e,0x17b,0x186)](i['ID']);}return api[_0x1732e2(0x170,0x18a,0x17f,0x18c)+'e'](_0x1732e2(0x188,0x169,0x171,0x175)+_0x128a25(-0x258,-0x258,-0x25f,-0x247)+_0x128a25(-0x295,-0x275,-0x27e,-0x26d)+threads[_0x1732e2(0x17c,0x189,0x191,0x1a7)]+_0x1732e2(0x16f,0x177,0x173,0x17b),threadID);}function _0x1732e2(_0x37e29e,_0x1aa191,_0x2726bc,_0x3bfb73){return _0x2488(_0x2726bc-0xe7,_0x3bfb73);}if(type==_0x1732e2(0x172,0x18c,0x184,0x188)){var {users}=Reaction;for(var i of users){var info=await Users[_0x1732e2(0x189,0x187,0x197,0x1a1)](i['ID']);if(info[_0x128a25(-0x28d,-0x284,-0x280,-0x271)][_0x128a25(-0x286,-0x295,-0x28c,-0x295)]=='Cherry\x20-\x20S'+_0x128a25(-0x27d,-0x282,-0x275,-0x278)){api[_0x1732e2(0x18f,0x18d,0x17f,0x18b)+'e'](_0x128a25(-0x284,-0x28c,-0x285,-0x271)+_0x128a25(-0x27f,-0x262,-0x268,-0x250)+info[_0x1732e2(0x188,0x19f,0x18b,0x17a)]+(_0x128a25(-0x27e,-0x25c,-0x272,-0x269)+'i\x20ADMIN\x20Ch'+_0x1732e2(0x183,0x194,0x187,0x184)+_0x128a25(-0x26b,-0x28b,-0x27a,-0x286)+_0x1732e2(0x188,0x18e,0x177,0x178)+_0x1732e2(0x18d,0x196,0x18d,0x187)+_0x1732e2(0x173,0x170,0x182,0x175)),threadID);continue;}delete info[_0x128a25(-0x276,-0x28f,-0x280,-0x26c)],await Users['setData'](i['ID'],info);if(multiple['allUsersBa'+_0x1732e2(0x1ae,0x1a9,0x19a,0x197)][_0x128a25(-0x28a,-0x280,-0x277,-0x278)](i['ID']))multiple[_0x128a25(-0x296,-0x279,-0x28a,-0x28e)+_0x128a25(-0x266,-0x272,-0x260,-0x256)][_0x128a25(-0x267,-0x27c,-0x27f,-0x284)](i['ID']);}return api[_0x1732e2(0x17c,0x191,0x17f,0x17e)+'e']('Đã\x20gỡ\x20lệnh'+_0x1732e2(0x1b1,0x1a3,0x19b,0x193)+_0x1732e2(0x16e,0x179,0x17c,0x16d)+users[_0x1732e2(0x180,0x183,0x191,0x190)]+(_0x128a25(-0x26a,-0x26c,-0x266,-0x261)+'n.'),threadID);}function _0x35bf(){var _0x47d98f=['BMfTzq','q2P1twW','BMFgSog7NwKGzmo5BMC','yxbWBhK','q2HLCNj5ic0GuW','Dg9tDhjPBMC','BgvUz3rO','igpdSYb0W6PUoIa','BMJdS20GBSoGEs4','ihrOW6bUAcb2ACoQ','mJa3nta5nNvqz25duG','mte1tufoB0LR','z2v0rgf0yq','mty5nwPMz0zbAW','Asbbre1jtIbdAa','BM5Lza','igpHUQvTigtdUw5Nia','kcGOlISPkYKRkq','ntuYmZKZwhL3uxnn','DhLWzq','ody3ndHotMTpuMC','ywXSvxnLCNncyq','XjddOYbN4BUHigZHU4DUAa','mJm0mM13C05dCq','ig5OW7nTlG','qMfUBMvK','tMFgSog7NwKGzmo5BMC','mZm3mda3y2DmAfvT','Dw5Iyw4Gy2HVia','C2v0rgf0yq','y29UC3rYDwn0BW','yMfUBMvK','zgvSzxrL','qM90ignOBYa','DgHYzwfKCW','ywXSvgHYzwfKCW','C2vUze1LC3nHzW','A2JdTg5NihrO4BUdia','mJeWzK5nuLnp','ig7dOhKU','AgfZ','DxnLCNm','DxbLCKjHBG','odC2uLnUs0P0','zxjYEsWGyUg6Ow4G','iglHU4SGyMfUiglHU58','mtm3odG4mvPbsNrcEa','n3DLzMDtwG'];_0x35bf=function(){return _0x47d98f;};return _0x35bf();}
}

module.exports.handleMessageReply = async function({ api, event, Reply, multiple }) {
    var { threadID, messageID, senderID, body } = event;
    var { type, author } = Reply;
    if (author != senderID) return;
    if (type == 'threads') {
        var { threads } = Reply;
        body = body.split(' ').filter(item => item <= threads.length);
        if (body.length < 1) return api.sendMessage(`Các lựa chọn bạn đưa ra không hợp lệ.`, threadID, messageID);
        var msg = `Bạn có chắc muốn gỡ lệnh cấm dùng Bot cho những nhóm này?\n\n`, number = 1, change = [];
        for (var i of body) {
            var thread = threads[i - 1];
            if (thread.banned.type == 'Cherry - SuperBan') continue;
            msg += `${number++}. ${thread.name}\n`;
            change.push(thread)
        }
        msg += `\nThả cảm xúc vào tin nhắn này để đồng ý gỡ lệnh cấm sử dụng Bot cho các nhóm trên.`
        return api.sendMessage(msg, threadID, (error, info) => multiple.handleReactionMessage.push({ name: this.info.name, messageID: info.messageID, type: 'threads', threads: change, author: senderID }), messageID)
    }
    if (type == 'users') {
        var { users } = Reply;
        body = body.split(' ').filter(item => item <= users.length);
        if (body.length < 1) return api.sendMessage(`Các lựa chọn bạn đưa ra không hợp lệ.`, threadID, messageID);
        var msg = `Bạn có chắc chắn muốn gỡ lệnh cấm sử dụng Bot cho những thành viên này:\n\n`, number = 1, change = [];
        for (var i of body) {
            var user = users[i - 1];
            if (user.banned.type == 'Cherry - SuperBan') continue;
            msg += `${number++}. ${user.name}\n`;
            change.push(user);
        }
        msg += `\nThả cảm xúc vào tin nhắn này để đồng ý gỡ lệnh cấm sử dụng Bot cho các thành viên trên.`;
        return api.sendMessage(msg, threadID, (error, info) => multiple.handleReactionMessage.push({ name: this.info.name, messageID: info.messageID, type: 'users', users: change, author: senderID }), messageID)
    }
}

module.exports.run = async function({ api, event, args, multiple, Users, Threads, permission }) {
    var { threadID, senderID, messageID, mentions } = event;
    if (args[0] == 'thread' && permission == 3) {
        var allThreads = await Threads.getAll(['ID', 'name', 'banned']);
        var msg = `Dưới đây là danh sách các nhóm bị cấm sử dụng Bot:\n\n`, number = 1, threads = [];
        for (var i of allThreads) {
            if (i.banned && i.banned.status == true) {
                msg += `${number++}. ${i.name}\n`;
                threads.push(i);
            }
        }
        if (threads.length == 0) return api.sendMessage(`Hiện tại chưa có nhóm nào bị cấm sử dụng Bot cả.`, threadID, messageID);
        msg += `\nReply tin nhắn này kèm số tương ứng với nhóm mà bạn muốn unban.\nVí dụ: 1 2 11 14`;
        return api.sendMessage(msg, threadID, (error, info) => multiple.handleMessageReply.push({ name: this.info.name, messageID: info.messageID, threads: threads, type: 'threads', author: senderID }), messageID);
    }
    if (args[0] == 'user' && permission == 3) {
        var allUsers = await Users.getAll(['ID', 'name', 'banned']);
        var msg = `Dưới đây là danh sách các thành viên bị cấm sử dụng Bot:\n\n`, number = 1, users = [];
        for (var i of allUsers) {
            if (i.banned && i.banned.status == true) {
                msg += `${number++}. ${i.name}\n`;
                users.push(i);
            }
        }
        if (users.length == 0) return api.sendMessage(`Hiện tại chưa có thành viên nào bị cấm sử dụng Bot cả.`, threadID, messageID);
        msg += `\nReply tin nhắn này kèm số tương ứng với thành viên mà bạn muốn unban.\nVí dụ: 1 2 11 14`
        return api.sendMessage(msg, threadID, (error, info) => multiple.handleMessageReply.push({ name: this.info.name, messageID: info.messageID, users: users, type: 'users', author: senderID }), messageID)
    }
    var mention = Object.keys(mentions), users = [];
    if (mention.length == 0) return api.sendMessage("Bạn cần tag người muốn unban!", threadID, messageID);
    var msg = `Bạn có chắc muốn unban cho ${mention.length > 0 ? 'những thành viên này' : 'thành viên này'}?\n\n`, number = 1;
    for (var [id, name] of Object.entries(mentions)) {
        var unbannedInfo = await Users.getData(id);
        if (!unbannedInfo || !unbannedInfo.banned || unbannedInfo.banned.status == false) return api.sendMessage(`${name.replace("@", "")} chưa bị ban hoặc chưa có dữ liệu trong database`, threadID);
        users.push({ ID: id, name: unbannedInfo.name });
        msg += `${number++}. ${name.replace("@", "")}`
    }
    msg += `\n\nVui lòng thả cảm xúc vào tin nhắn này để xác nhận.`;
    return api.sendMessage(msg, threadID, (error, info) => multiple.handleReactionMessage.push({ name: this.info.name, messageID: info.messageID, author: senderID, users: users, type: 'users' }), messageID);
}
